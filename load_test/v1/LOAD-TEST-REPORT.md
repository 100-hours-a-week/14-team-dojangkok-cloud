# 도장콕 V1 부하 테스트 최종 보고서

## 1. 개요

### 1.1 테스트 목적

본 부하 테스트는 도장콕 V1 서비스의 **핵심 API 성능 기준선 확보** 및 **서버 안정성 검증**을 목적으로 수행하였습니다.
시장 가능성을 검증하기 위한 V1 단계에서, 실제 사용자 시나리오 기반의 부하를 인가하여 병목 지점과 서버 이슈를 사전에 식별하였습니다.

### 1.2 테스트 환경

| 항목 | 값 |
|------|-----|
| 대상 서버 | https://<PRODUCTION_URL> (Production) |
| 인프라 구성 | 단일 인스턴스 (모니터링 서버 제외) |
| 배포 방식 | 빅뱅 배포 |
| 테스트 도구 | k6 v1.4.0 |
| 테스트 클라이언트 | macOS (로컬) |
| 테스트 일시 | 2026-02-11 ~ 2026-02-12 |
| 인증 방식 | 단일 토큰 (카카오 소셜 로그인 기반) |
| Rate Limit | 비활성화 (단일 토큰 사용으로 인한 제약) |

### 1.3 공통 성공 기준 (Thresholds)

모든 시나리오에 아래 공통 기준이 적용되었으며, 시나리오별 API 개별 기준은 각 세부 문서에서 확인하실 수 있습니다.

| 지표 | 기준 |
|------|------|
| http_req_duration p(95) | < 3,000ms |
| http_req_duration p(99) | < 5,000ms |
| http_req_failed rate | < 5% |

---

## 2. 테스트 범위 및 시나리오 6~8 제외 사유

### 2.1 수행 시나리오 (1~5)

| 시나리오 | 설명 | VU | 테스트 시간 |
|----------|------|----|------------|
| 01 | 신규 사용자 온보딩 | 100 | 10분 |
| 02 | 기존 사용자 탐색 | 800 | 10분 |
| 03 | 집 노트 CRUD | 400 | 10분 |
| 04a | 집 노트 파일 업로드 | 150 | 10분 |
| 04b | 쉬운 계약서 파일 업로드 (OCR) | 10 | 10분 |
| 05 | 체크리스트 집중 사용 | 300 | 10분 |

### 2.2 미수행 시나리오 (6~8) 및 제외 사유

시나리오 6~8은 스크립트를 작성하였으나, V1 인프라 특성상 현 단계에서의 수행이 불필요하다고 판단하여 제외하였습니다. 스크립트 파일은 향후 V2 인프라 전환 시 활용할 수 있도록 유지하고 있습니다.

| 시나리오 | 유형 | 제외 사유 |
|----------|------|-----------|
| 06 | 혼합 현실적 부하 (975 VU) | 시나리오 1~5의 개별 결과에서 읽기 상한(~346 req/s)과 쓰기 상한(~200 req/s)이 이미 확인되었습니다. 단일 인스턴스에서 워크로드를 혼합하더라도 이 상한을 넘을 수 없으므로, 혼합 테스트의 추가적인 정보 가치가 제한적입니다. |
| 07 | 스파이크 테스트 (10→300 VU 급증) | 스파이크 테스트는 오토스케일링·로드밸런서 등 탄력적 인프라의 복원력을 검증하는 것이 목적입니다. 단일 인스턴스 빅뱅 배포 구조에서는 스케일링 대상 자체가 존재하지 않습니다. 또한 시나리오 3에서 VU를 단계별로 증가시킨 결과(200→300→400→600)가 이미 부하 증가에 따른 성능 변화 곡선을 제공하고 있습니다. |
| 08 | 내구성(Soak) 테스트 (50 VU, 60분) | 메모리 누수·커넥션 풀 고갈 등 장시간 운영 이슈를 탐지하는 테스트이나, 토큰 만료(30분)가 테스트 시간(60분)보다 짧아 실행 자체에 기술적 제약이 있습니다. 또한 모니터링 서버가 별도 구성되어 있으므로, 실제 운영 중 메트릭 추이를 통해 동일한 이슈를 감지할 수 있습니다. |

### 2.3 시나리오 1~5로 충분하다고 판단한 근거

V1 인프라는 **시장 가능성 확인을 위한 단계**로, 모니터링 서버를 제외한 모든 서비스가 단일 인스턴스로 구성된 빅뱅 배포 구조입니다. 이러한 인프라 특성을 고려할 때, 시나리오 1~5만으로도 다음 항목들이 충분히 검증되었습니다.

1. **서버 처리량의 상한과 하한을 확인하였습니다.** 읽기 전용 API는 800 VU(~346 req/s)까지, 쓰기 포함 API는 400 VU(~200 req/s)까지의 성능 기준선을 확보하였습니다. 단일 인스턴스의 물리적 처리 한계가 수치로 파악되었으므로, 혼합 테스트를 추가로 수행하더라도 이 범위를 벗어나는 새로운 정보를 얻기 어렵습니다.

2. **핵심 비즈니스 흐름 전체를 커버하였습니다.** 온보딩(1), 탐색(2), CRUD(3), 파일 업로드(4), 체크리스트 집중 사용(5)으로 사용자의 주요 행동 패턴을 모두 개별 검증하였습니다.

3. **실질적인 서버 이슈를 사전에 발견하였습니다.** DTO 역직렬화 NPE, `/error` → 401 마스킹 버그, AI 서버 동시 부하 내성 문제, OCR 동기 처리 한계 등 코드 수준의 버그와 아키텍처 수준의 개선 사항이 도출되었습니다. 추가 시나리오 수행보다 이 이슈들의 해결이 서비스 안정성에 더 직접적인 기여를 합니다.

4. **부하 증가에 따른 성능 변화 곡선을 확보하였습니다.** 시나리오 3에서 200→300→400→600 VU로 단계별 테스트를 수행하여, 서버의 포화 지점과 응답 시간 증가 패턴을 확인하였습니다. 이는 스파이크 테스트(시나리오 7)가 제공하는 정보와 상당 부분 중복됩니다.

---

## 3. 시나리오별 결과 요약

### 3.1 종합 결과

| 시나리오 | VU | 총 요청 | 에러율 | p(95) | 판정 | 세부 문서 |
|----------|----|---------|--------|-------|------|-----------|
| 01 신규 사용자 온보딩 | 100 | 36,348 | 22.71% | 153ms | **ISSUE** | [점검 기록](docs/scenario-01-review.md) · [결과 분석](docs/scenario-01-result.md) |
| 02 기존 사용자 탐색 | 800 | 209,432 | 0.00% | 476ms | **PASS** | [점검 기록](docs/scenario-02-review.md) · [결과 분석](docs/scenario-02-result.md) |
| 03 집 노트 CRUD | 400 | 118,660 | 0.00% | 1,061ms | **PASS** | [점검 기록](docs/scenario-03-review.md) · [결과 분석](docs/scenario-03-result.md) |
| 04a 집 노트 파일 업로드 | 150 | 122,712 | 0.017% | 2,570ms | **PASS** | [점검 기록](docs/scenario-04-review.md) · [결과 분석](docs/scenario-04-result.md) |
| 04b 쉬운 계약서 (OCR) | 10 | 1,728 | 18.6% | 363ms | **FAIL** | [점검 기록](docs/scenario-04-review.md) · [결과 분석](docs/scenario-04-result.md) |
| 05 체크리스트 집중 사용 | 300 | 120,269 | 0.00% | 569ms | **PASS** | [점검 기록](docs/scenario-05-review.md) · [결과 분석](docs/scenario-05-result.md) |

### 3.2 시나리오 01: 신규 사용자 온보딩

3차에 걸친 반복 실행을 통해 서버 측 버그를 발견하고 수정을 확인하였습니다.

| 실행 | PATCH /members/nickname | POST /lifestyles | 주요 발견 |
|------|------------------------|------------------|-----------|
| 1차 (02-11) | 100% 실패 (422) | 100% 실패 (401) | 닉네임 길이 초과 + DTO NPE |
| 2차 (02-11) | **100% 성공** | 100% 실패 (401) | 닉네임 수정 완료, DTO NPE 잔존 |
| 3차 (02-12) | **100% 성공** | **54% 성공, 46% 실패** | NPE 수정 확인, AI 서버 의존성 이슈 발견 |

- 닉네임 API는 100 VU에서 p(95) 151ms로 안정적으로 동작하였습니다.
- 라이프스타일 API는 순차 호출 시 100% 성공하였으나, 동시 부하(100 VU)에서 46%가 실패하였습니다. AI 서버에 대한 후속 호출이 동시 요청을 처리하지 못하는 것으로 추정됩니다.
- 서버 내부 에러가 `/error` → 401로 마스킹되어 정확한 에러 원인을 k6에서 식별할 수 없는 문제가 확인되었습니다.

> 세부 내용: [점검 기록](docs/scenario-01-review.md) · [결과 분석](docs/scenario-01-result.md)

### 3.3 시나리오 02: 기존 사용자 탐색

800 VU 동시 접속에서 모든 GET API가 안정적으로 동작하였습니다.

| API | avg | p(95) | max | Threshold 결과 |
|-----|-----|-------|-----|---------------|
| GET /members/me | 265ms | 469ms | 20.83s | PASS (< 1,000ms) |
| GET /lifestyles | 261ms | 455ms | 30.53s | PASS (< 1,000ms) |
| GET /home-notes | 290ms | 510ms | 38.70s | PASS (< 2,000ms) |
| GET /home-notes/{id}/checklists | 267ms | 468ms | 54.57s | PASS (< 1,500ms) |

- 총 209,432건의 요청을 346 req/s로 처리하였으며, 에러율은 0.00%였습니다.
- max 응답 시간이 20~54초로 높게 나타났으나, p(99)이 651ms인 점을 감안하면 ramp-up 단계의 일시적 지연으로 판단됩니다.

> 세부 내용: [점검 기록](docs/scenario-02-review.md) · [결과 분석](docs/scenario-02-result.md)

### 3.4 시나리오 03: 집 노트 CRUD

쓰기 작업이 포함된 핵심 비즈니스 흐름에서 서버의 처리 한계를 단계별로 확인하였습니다.

| VU | avg | p(95) | 요청 속도 | 상태 |
|----|-----|-------|----------|------|
| 200 | 89ms | 190ms | 162 req/s | 여유 |
| 300 | 339ms | 524ms | 193 req/s | 양호 |
| 400 | 702ms | 969ms | 200 req/s | 경계 |
| 600 | 1,422ms | 1,962ms | 207 req/s | 포화 |

- CRUD 처리량의 상한은 약 **200 req/s**로 확인되었으며, VU를 증가시켜도 처리량은 더 이상 증가하지 않았습니다.
- 400 VU에서 체크리스트 항목 토글 API의 p(95)가 1,056ms로 기준(1,000ms)을 소폭 초과하였습니다.

> 세부 내용: [점검 기록](docs/scenario-03-review.md) · [결과 분석](docs/scenario-03-result.md)

### 3.5 시나리오 04a: 집 노트 파일 업로드

Presigned URL → S3 업로드 → 완료 처리 → 파일 첨부의 전체 파이프라인이 150 VU에서 정상 동작하였습니다.

| 구간 | avg | p(95) | 상태 |
|------|-----|-------|------|
| Presigned URL 발급 | 1,351ms | 2,038ms | 양호 |
| S3 업로드 | 60ms | 129ms | 매우 빠름 |
| 업로드 완료 처리 | 2,074ms | 3,627ms | **병목** |
| 파일 첨부 | 1,332ms | 2,037ms | 경계 |

- S3 업로드는 외부 서비스임에도 p(95) 129ms로 가장 안정적인 구간이었습니다.
- `files/complete` API가 p(95) 3,627ms로 threshold(2,000ms) 대비 1.8배 초과하여 최대 병목으로 확인되었습니다.

> 세부 내용: [점검 기록](docs/scenario-04-review.md) · [결과 분석](docs/scenario-04-result.md)

### 3.6 시나리오 04b: 쉬운 계약서 파일 업로드 (OCR)

파일 업로드 파이프라인 자체는 100% 정상이었으나, OCR 계약서 생성에서 87.5%가 실패하였습니다.

| 지표 | 값 |
|------|-----|
| OCR 성공 | 46건 / 367건 (12.5%) |
| 실패 원인 | 502 Bad Gateway (리버스 프록시 업스트림 큐 포화) |
| 1건당 OCR 소요 시간 | 22~76초 (avg 39.7초) |
| 실제 처리 용량 | 분당 약 4.6건 |

- OCR은 CPU/GPU 집약적 작업으로, 현재 동기 방식으로는 10 VU에서도 동시 처리가 불가능합니다.
- 502 응답의 91.3%가 즉시 거절 패턴으로, 리버스 프록시 단에서 업스트림 큐 포화로 차단되고 있습니다.

> 세부 내용: [점검 기록](docs/scenario-04-review.md) · [결과 분석](docs/scenario-04-result.md)

### 3.7 시나리오 05: 체크리스트 집중 사용

이터레이션당 25회의 PATCH 요청이 반복되는 쓰기 집중 패턴에서 300 VU 기준 안정적으로 동작하였습니다.

| API | avg | p(95) | Threshold 결과 |
|-----|-----|-------|---------------|
| GET /home-notes/{id}/checklists | 298ms | 565ms | PASS (< 1,500ms) |
| PATCH /checklists/items/{id} | 308ms | 569ms | PASS (< 800ms) |
| PUT /home-notes/{id}/checklists | 320ms | 572ms | PASS (< 2,000ms) |

- 시나리오 3(일반 CRUD)과 동일 VU(300)에서 비교한 결과, 체크리스트 PATCH 집중 패턴이 유의미한 성능 차이를 보이지 않았습니다.
- DB row-level lock 경합이 문제가 되지 않는 수준임을 확인하였습니다.

> 세부 내용: [점검 기록](docs/scenario-05-review.md) · [결과 분석](docs/scenario-05-result.md)

---

## 4. 서버 처리량 요약

시나리오 1~5의 결과를 종합하여, V1 단일 인스턴스의 처리량 상한을 아래와 같이 정리하였습니다.

| 워크로드 유형 | 최대 VU | 처리량 상한 | 근거 시나리오 |
|--------------|---------|-----------|-------------|
| 읽기 전용 (GET) | 800 | ~346 req/s | 시나리오 02 |
| 쓰기 포함 (CRUD) | 400 | ~200 req/s | 시나리오 03 |
| 쓰기 집중 (PATCH 반복) | 300 | ~193 req/s | 시나리오 05 |
| 파일 업로드 (S3 연동) | 150 | ~204 req/s | 시나리오 04a |
| OCR 처리 | 10 | ~4.6건/분 | 시나리오 04b |

---

## 5. 발견된 이슈 및 개선 권장 사항

### 5.1 서버 버그

| 이슈 | 심각도 | 상태 | 발견 시나리오 |
|------|--------|------|-------------|
| DTO 기본 생성자 누락 → NPE | High | **수정됨** | 01 |
| 에러 페이지 → 401 마스킹 (서버 내부 에러가 인증 오류로 변환) | Medium | **미수정** | 01 |
| AI 서버 동시 부하 내성 부족 (라이프스타일 생성 시 46% 실패) | Medium | **미해결** | 01 |

### 5.2 성능 병목

| 병목 지점 | 현재 성능 | Threshold | 개선 방향 |
|-----------|----------|-----------|-----------|
| `POST /home-notes/files/complete` | p(95) 3,627ms | 2,000ms | DB 쿼리 또는 후처리 로직 최적화가 필요합니다. |
| `PATCH /checklists/items/{id}` (400 VU) | p(95) 1,056ms | 1,000ms | 임계값을 1,100ms로 완화하거나, 쿼리 최적화를 검토할 수 있습니다. |
| `POST /easy-contracts` (OCR) | 87.5% 실패 (502) | - | 비동기 처리 전환이 필수적입니다. (요청 접수 → 폴링/웹훅) |

### 5.3 개선 권장 사항

**서버 측**

1. **에러 페이지 경로를 인증 없이 접근 가능하도록 보안 설정 수정** — 서버 내부 에러가 401로 마스킹되는 문제를 해결하면, AI 서버 오류의 정확한 원인(타임아웃, 503, 커넥션 거부 등)을 파악할 수 있습니다.
2. **AI 서버 호출 에러 핸들링 개선** — 라이프스타일 생성 시 AI 서버에 대한 타임아웃 설정, 재시도 로직, 서킷브레이커 패턴 도입을 권장합니다.
3. **OCR 비동기 처리 전환** — 현재 동기 방식(1건당 22~76초)으로는 동시 처리가 불가능합니다. 요청 접수 후 비동기 처리 + 결과 조회 방식으로의 전환이 필요합니다.
4. **리버스 프록시 타임아웃 조정** — OCR 엔드포인트의 프록시 타임아웃을 최소 120초로 설정하여 업스트림 타임아웃으로 인한 502를 방지할 수 있습니다.
5. **`files/complete` API 응답 최적화** — 파일 업로드 완료 처리 API의 DB 쿼리 또는 후처리 로직을 점검하여 응답 시간을 단축할 것을 권장합니다.

---

## 6. 테스트 환경의 한계점

### 6.1 단일 토큰 사용

카카오 소셜 로그인 구조상 다수의 독립 계정 토큰을 자동 생성할 수 없어, 단일 토큰으로 모든 VU를 실행하였습니다. 이로 인해 Rate Limit 정책을 비활성화한 상태에서 테스트를 수행하였으며, 동일 사용자에 대한 동시 요청이므로 실제 다중 사용자 시나리오와 차이가 있을 수 있습니다.

### 6.2 DB 캐시 효과

단일 사용자의 데이터를 반복 조회하므로, DB 캐시 히트율이 실제 서비스보다 높을 수 있습니다. 특히 읽기 전용 시나리오(02)에서 이 효과가 두드러질 수 있으며, 실제 다중 사용자 환경에서는 응답 시간이 더 증가할 가능성이 있습니다.

### 6.3 네트워크 환경

테스트 클라이언트(macOS 로컬)에서 프로덕션 서버로 직접 요청을 전송하였으므로, 네트워크 지연이 응답 시간에 포함되어 있습니다. 서버 내부의 순수 처리 시간은 측정값보다 짧을 수 있습니다.

---

## 7. 결론

V1 단일 인스턴스 인프라에서 시나리오 1~5의 부하 테스트를 완료하였습니다.

**안정적으로 확인된 영역:**
- 읽기 API는 800 VU(~346 req/s)에서 에러율 0%, p(95) 476ms로 매우 안정적입니다.
- 쓰기 포함 CRUD는 400 VU(~200 req/s)에서 안정적으로 동작합니다.
- 파일 업로드 파이프라인(S3 연동)은 150 VU에서 전 구간 정상 동작합니다.
- 체크리스트 PATCH 집중 패턴은 일반 CRUD와 성능 차이가 거의 없습니다.

**우선 해결이 필요한 영역:**
- `/error` → 401 마스킹 버그 수정이 선행되어야, AI 서버 의존성 이슈의 정확한 원인을 파악할 수 있습니다.
- OCR 처리는 비동기 전환 없이는 서비스 안정성을 확보할 수 없습니다.

시나리오 6(혼합 부하), 7(스파이크), 8(내구성) 테스트는 V2에서 다중 인스턴스·오토스케일링 인프라로 전환한 이후에 수행하는 것을 권장합니다.

---

## 8. 부록

### 8.1 테스트 스크립트

| 파일 | 시나리오 |
|------|----------|
| `scenarios/scenario-01-new-user-onboarding.js` | 시나리오 01 |
| `scenarios/scenario-02-returning-user-browse.js` | 시나리오 02 |
| `scenarios/scenario-03-home-note-crud.js` | 시나리오 03 |
| `scenarios/scenario-04a-home-note-file-upload.js` | 시나리오 04a |
| `scenarios/scenario-04b-easy-contract-file-upload.js` | 시나리오 04b |
| `scenarios/scenario-05-checklist-intensive.js` | 시나리오 05 |
| `scenarios/scenario-06-mixed-realistic.js` | 시나리오 06 (미수행, 스크립트 보관) |
| `scenarios/scenario-07-spike-test.js` | 시나리오 07 (미수행, 스크립트 보관) |
| `scenarios/scenario-08-soak-test.js` | 시나리오 08 (미수행, 스크립트 보관) |

### 8.2 세부 문서

| 시나리오 | 점검 기록 | 결과 분석 |
|----------|-----------|-----------|
| 01 신규 사용자 온보딩 | [scenario-01-review.md](docs/scenario-01-review.md) | [scenario-01-result.md](docs/scenario-01-result.md) |
| 02 기존 사용자 탐색 | [scenario-02-review.md](docs/scenario-02-review.md) | [scenario-02-result.md](docs/scenario-02-result.md) |
| 03 집 노트 CRUD | [scenario-03-review.md](docs/scenario-03-review.md) | [scenario-03-result.md](docs/scenario-03-result.md) |
| 04 파일 업로드 | [scenario-04-review.md](docs/scenario-04-review.md) | [scenario-04-result.md](docs/scenario-04-result.md) |
| 05 체크리스트 집중 사용 | [scenario-05-review.md](docs/scenario-05-review.md) | [scenario-05-result.md](docs/scenario-05-result.md) |

