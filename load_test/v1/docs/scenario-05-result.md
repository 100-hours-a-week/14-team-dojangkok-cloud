# 시나리오 5: 체크리스트 집중 사용 - 결과 분석

## 실행 정보

### 1차 실행 (100 VU)

| 항목 | 값 |
|------|-----|
| 실행 일시 | 2026-02-12 15:57:05 KST |
| 대상 서버 | https://<PRODUCTION_URL> |
| 테스트 시간 | 10분 24초 |
| 최대 VU | 100 |
| 토큰 방식 | 단일 토큰 (1개) |
| Rate Limit | 활성화 상태 |
| 결과 파일 | `results/20260212_155705_scenario-5.json` |

### 2차 실행 (300 VU)

| 항목 | 값 |
|------|-----|
| 실행 일시 | 2026-02-12 16:12:52 KST |
| 대상 서버 | https://<PRODUCTION_URL> |
| 테스트 시간 | 10분 24초 |
| 최대 VU | 300 |
| 토큰 방식 | 단일 토큰 (1개) |
| Rate Limit | 활성화 상태 |
| 결과 파일 | `results/20260212_161252_scenario-5.json` |

## 요약

1차(100 VU)에서 서버 여력이 충분하여, 2차(300 VU)로 증가 테스트를 수행하였습니다.
**2차 실행: 모든 Threshold 통과, 에러율 0.00%, check 성공율 100%.**

- 총 요청: **120,269건** (3,993 iterations)
- 처리량: **192.70 req/s**
- 에러율: **0.00%**
- 전체 check 성공율: **100%** (124,279 / 124,279)
- 이터레이션당 API 호출: 30건 (생성 1 + 체크리스트 조회 2 + 토글 25 + 일괄수정 1 + 삭제 1)
- 체크리스트 항목 수: 22개 (전체 토글 22 + 일부 해제 3 = 25회 PATCH/iteration)

## Threshold 결과 (2차 - 300 VU)

| Threshold | 기준 | 실제 | 결과 |
|-----------|------|------|------|
| http_req_duration p(95) | < 3000ms | 568.76ms | **PASS** |
| http_req_duration p(99) | < 5000ms | 839.63ms | **PASS** |
| http_req_failed rate | < 5% | 0.00% | **PASS** |
| GET /home-notes/{id}/checklists p(95) | < 1500ms | 564.82ms | **PASS** |
| PATCH /checklists/items/{id} p(95) | < 800ms | 568.75ms | **PASS** |
| PUT /home-notes/{id}/checklists p(95) | < 2000ms | 572.12ms | **PASS** |

## 응답 시간 (2차 - 300 VU)

### 전체 종합

| 지표 | 값 |
|------|-----|
| avg | 308.00ms |
| med | 300.04ms |
| p(90) | 461.19ms |
| p(95) | 568.76ms |
| p(99) | 839.63ms |
| max | 35.14s |

### API별 응답 시간

| API | avg | med | p(90) | p(95) | max |
|-----|-----|-----|-------|-------|-----|
| `GET /home-notes/{id}/checklists` | 297.83ms | 288.34ms | 447.81ms | 564.82ms | 35.14s |
| `PATCH /checklists/items/{id}` | 308.13ms | 299.89ms | 461.20ms | 568.75ms | 27.70s |
| `PUT /home-notes/{id}/checklists` | 320.41ms | 316.32ms | 482.22ms | 572.12ms | 1.30s |

### 처리량

| 지표 | 값 |
|------|-----|
| 총 요청 수 | 120,269 |
| 요청 속도 | 192.70 req/s |
| 이터레이션 속도 | 6.40 iter/s |
| 수신 데이터 | 109 MB (175 kB/s) |
| 송신 데이터 | 28 MB (45 kB/s) |

### 요청 분포

| API | 요청 수 | 비고 |
|-----|---------|------|
| POST /home-notes | 3,993 | 이터레이션당 1회 |
| GET /home-notes/{id}/checklists | 7,986 | 이터레이션당 2회 (조회 + 최종확인) |
| PATCH /checklists/items/{id} | 99,825 | 이터레이션당 25회 (전체 토글 22 + 해제 3) |
| PUT /home-notes/{id}/checklists | 3,993 | 이터레이션당 1회 |
| DELETE /home-notes/{id} | 3,993 | 이터레이션당 1회 |

### Check 결과 상세

| Check | 성공 | 실패 | 성공률 |
|-------|------|------|--------|
| [집노트생성] 상태 200/201/429 | 3,993 | 0 | 100% |
| [집노트생성] home_note_id 존재 | 3,993 | 0 | 100% |
| [체크리스트조회] 상태 200/429 | 7,986 | 0 | 100% |
| [체크리스트토글] 상태 200/429 | 99,825 | 0 | 100% |
| [체크리스트수정] 상태 200/429 | 3,993 | 0 | 100% |
| [집노트삭제] 상태 204/429 | 3,993 | 0 | 100% |

## VU별 비교

| 지표 | 100 VU (1차) | 300 VU (2차) |
|------|-------------|-------------|
| 에러율 | 0.04% | **0.00%** |
| check 성공율 | 99.95% | **100%** |
| avg 응답 시간 | 53.82ms | 308.00ms |
| med 응답 시간 | 37.02ms | 300.04ms |
| p(90) 응답 시간 | 105.86ms | 461.19ms |
| p(95) 응답 시간 | 125.35ms | 568.76ms |
| p(99) 응답 시간 | 245.49ms | 839.63ms |
| max 응답 시간 | 1.13s | 35.14s |
| 요청 속도 | 80.74 req/s | **192.70 req/s** |
| 총 요청 수 | 50,400 | **120,269** |
| 이터레이션 수 | 1,680 | **3,993** |
| 중단된 이터레이션 | 0 | 17 |
| Threshold | 전체 PASS | **전체 PASS** |

## 분석

### 1. VU별 성능 변화

| VU | avg | p(95) | 요청 속도 | 상태 |
|----|-----|-------|----------|------|
| 100 | 53.82ms | 125.35ms | 80.74 req/s | 여유 |
| **300** | **308.00ms** | **568.76ms** | **192.70 req/s** | **양호** |

- 100 → 300 VU (3배): p(95) **4.5배** 증가 (125 → 569ms)
- 요청 속도는 2.4배 증가 (81 → 193 req/s), VU 증가 대비 sublinear — 서버 포화 근접 신호

### 2. 시나리오 3과의 동일 부하 수준 비교

시나리오 3(300 VU)과 시나리오 5(300 VU)는 거의 동일한 요청 속도(~193 req/s)를 보였습니다:

| 지표 | 시나리오 3 (300 VU) | 시나리오 5 (300 VU) |
|------|---------------------|---------------------|
| 요청 속도 | 193 req/s | 192.70 req/s |
| avg 응답 시간 | 339ms | 308ms |
| p(95) 응답 시간 | 524ms | 569ms |
| p(99) 응답 시간 | 735ms | 840ms |
| max 응답 시간 | 37.65s | 35.14s |
| 에러율 | 0% | 0% |
| Threshold | 전체 PASS | 전체 PASS |

- avg 응답 시간은 시나리오 5가 약간 빠름 (308ms vs 339ms)
- p(95)~p(99)는 시나리오 5가 약간 느림 (569ms vs 524ms, 840ms vs 735ms)
- 체크리스트 PATCH 집중 패턴이 **상위 퍼센타일에서 약간의 지연**을 유발하지만, 전체적으로 동일 수준의 성능
- 쓰기 집중 패턴이 특별히 더 나쁜 성능을 보이지 않음 — DB row-level lock 경합이 문제가 되지 않는 수준

### 3. 체크리스트 토글 에러 개선

1차(100 VU)에서 24건이던 토글 실패가 2차(300 VU)에서 0건으로 개선되었습니다.
1차 실패는 rate limit가 아닌 일시적 서버 상태에 의한 것으로, 300 VU에서 재현되지 않았습니다.

### 4. max 응답 시간 이상치

GET 체크리스트에서 35.14s, PATCH 토글에서 27.70s의 이상치가 관찰됩니다.
p(99)가 840ms인 점을 감안하면, 극소수 요청에서 일시적 서버 지연이 발생한 것으로 보입니다.

### 5. 결론

- **300 VU**: 모든 threshold 여유 있게 통과 (PATCH p(95) 569ms, 임계값 800ms 대비 1.4배 여유)
- 서버 처리 한계(~200 req/s)에 근접한 192.70 req/s에서도 안정적
- **체크리스트 PATCH 집중 패턴은 시나리오 3(일반 CRUD)과 성능 차이가 거의 없음**
- 짧은 간격의 반복 PATCH가 DB 쓰기 부하에 유의미한 영향을 주지 않는 것으로 확인
- **300 VU를 시나리오 5의 확정 VU로 채택** (시나리오 3과 동일)
