# 도장콕 IaC 설계문서 - V1 릴리즈 기준 (v1.2.11)

- 작성일: 2025-01-25
- 최종수정일: 2026-01-29
- 작성자: howard.ha(하주영), waf.jung(정승환)
- 상태: review
- 관련문서: ./aws/docs.md, ./gcp/GCP IaC 도입 설계문서.md, ../../../docs/overview/dojangkok_overview_v0_0_3.md
- 릴리즈: V1

---

## 개요

**도장콕**은 임차인의 부동산 임대 계약 과정(계약 전·계약 중)을 지원하는 서비스입니다.
<br>핵심 기능: 쉬운 계약서(해설+리스크 검증) | 집노트(답사/비교/체크리스트) | 임대 매물 커뮤니티

**본 문서**: V1 릴리즈 기준의 IaC 설계(멀티 클라우드 구성, Terraform 리소스 범위, 향후 계획)를 정리합니다.

---

## 목차

1. [도입 이유](#1-도입-이유)
2. [V1 인프라 구성](#2-v1-인프라-구성)
3. [향후 계획](#3-향후-계획)
4. [참고: 주의사항](#참고-주의사항)

---

## 1. 도입 이유

### 1.1 도장콕의 상황

**팀 구성**
- 6인 팀, 그 중 인프라 담당 2명

**서비스 특성**
- AI 기반 서비스: LLM이 핵심 기능 (체크리스트 생성, 계약서 해설/검증)
- GPU 필수: 오픈소스 LLM 커스텀 모델 추론을 위한 자체 GPU 서버 필요
- V1 MVP 단계: 빠른 출시 후 점진적 확장 계획 (V1 릴리즈 이후 DEV → STG → PRD)

### 1.2 왜 멀티 클라우드(AWS + GCP)인가?

**메인 서비스와 AI 서비스의 관심사 분리** + **AWS GPU 비용 부담을 팀원 GCP 무료 크레딧으로 보완**.

| 클라우드 | 용도 | 선택 이유 |
|:--------:|------|-----------|
| AWS | Backend, Frontend, 스토리지 | 팀 숙련도 높음, 메인 인프라 |
| GCP | LLM 추론 서버 (GPU) | 팀원 다계정 무료 크레딧 활용 |

**부가 효과**: 메인/AI 서비스 독립적 스케일링 가능

### 1.3 왜 Terraform을 선택했는가?

멀티 클라우드(AWS + GCP)를 효율적으로 관리하기 위해 IaC 도구 도입.

**IaC 도구 비교**
| 항목 | AWS CloudFormation | GCP Deployment Manager | Terraform |
|------|-------------------|------------------------|-----------|
| 지원 클라우드 | AWS 전용 | GCP 전용 | 멀티 클라우드 |
| 학습 비용 | AWS만 학습 | GCP만 학습 | 단일 문법으로 양쪽 관리 |
| 상태 관리 | AWS 내부 | GCP 내부 | State 파일 (유연) |
| 커뮤니티 | AWS 공식 | GCP 공식 | 대규모 오픈소스 |

**선택 이유**: AWS + GCP를 단일 도구로 관리 → 학습/운영 비용 절감

**IaC 도입 효과**
| 관점 | 콘솔 수동 구성 | IaC 도입 후 |
|------|---------------|-------------|
| 환경 복제 | 반복 작업, 실수 가능 | 코드로 일관성 있게 복제 |
| 변경 추적 | 추적 어려움 | Git으로 모든 변경 기록 |
| 협업 | 구두/문서 공유 | PR 기반 리뷰/승인 |
| 롤백 | 수동 복구 | 이전 버전으로 신속 롤백 |

---

## 2. V1 인프라 구성

### AWS (메인 서비스, 핵심 리소스)

| 분류 | 리소스 | 파일 |
|------|--------|------|
| 네트워크 | VPC, 서브넷, 라우팅 | `vpc.tf`, `subnets.tf`, `routes.tf` |
| 보안 | Security Groups, IAM | `security_groups.tf`, `iam.tf`, `iam_users.tf` |
| 컴퓨팅 | EC2 | `ec2.tf` |
| 스토리지 | S3 | `s3.tf` |

### GCP (AI 서비스, 핵심 리소스)

| 분류 | 리소스 | 파일 |
|------|--------|------|
| IAM | Service Account, Workload Identity | `service_account.tf`, `workload_identity.tf` |
| 네트워크 | Firewall (8000, 8001, 8100 / 9100, 9400) | `firewall.tf` |
| 컴퓨팅 | AI Server (n1-standard-2 + T4 GPU, 200GB SSD) | `compute.tf` |

---

## 3. 향후 계획

- 인프라 변경 시 본 문서 업데이트
- V1 릴리즈 이후 환경 분리 (DEV/STG/PRD)

---

## 참고: 주의사항

- `terraform.tfvars`는 Git에 커밋하지 않음 (`.gitignore`)
- 변경 전 반드시 `terraform plan`으로 영향 확인
- GPU VM은 `on_host_maintenance = TERMINATE` 필수 (코드에 자동 반영)
- GPU 할당은 GCP Quota 승인 필요
