# 문제상황 : Web Server로 무엇을 사용할 것인가?

## 의사 결정 기준
1. 정적파일 제공, 리버스 프록시, TLS 종단 기능을 제공해야 한다.
2. 많은 요청을 받아도 동일 인스턴스에서 실행 중인 WAS, DB 성능에 유의미한 영향을 주지 않아야 한다 (메모리 500MB 이하, 평시 CPU 사용률 5% 미만).
```
CPU 사용률 5% 미만 기준은 절대적인 수치 비교보다는,
정적 파일/프록시 중심 워크로드에서 WAS 및 DB 성능에
유의미한 영향을 주지 않는 수준을 의미하는 지표로 사용하였다.
```
```
메모리 한도를 500MB로 설정한 이유는 본 서비스가 단일 인스턴스 환경에서 실행되기 때문이다.
현재 설계상 단일 인스턴스로 m7g.large (2vCPU, 8GB RAM)를 사용하는데, 메모리 점유 내역을 시뮬레이션하면 다음과 같다.

1. OS 및 시스템: 1GB
2. Spring Boot WAS: 2GB
3. MySQL DB: 3GB (InnoDB Buffer Pool 기준)
-> [합계: 6GB]

즉, Web Server 없이도 이미 6GB가 필요한 상황이다.
전체 8GB 메모리 중 남은 2GB에서, OS 차원의 Page Cache(I/O 성능 향상) 확보와 MySQL Connection Overhead 등을 고려하여
최소 1.5GB의 안전 마진을 남겨두어야 한다. 따라서 Web Server가 사용할 수 있는 가용 메모리 한도를 최대 500MB로 제한했다.
```
3. ARM64 기반 Ubuntu 24.04 LTS 런타임에서 안정적으로 서비스 가능해야 한다.
4. MVP 개발 단계인 만큼 설정 및 운영에 필요한 러닝커브, 작업시간이 최소화 되어야 한다.

그리고 위 기준들에 대해서 다음과 같은 우선순위를 적용하였다.
1. 기능 충족: 필수(탈락 조건)
2. 리소스 영향 최소화: 필수(탈락 조건)
3. ARM64/Ubuntu 안정성: 필수(탈락 조건)
4. 러닝커브/운영 리스크: 동점일 때 최종 결정 기준

## 대상후보
대상 후보는 다음 기준을 만족하거나, 검토할 가치가 있다고 판단되는 웹서버들을 종합하였다.
- 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 기본적으로 지원
- 이벤트 기반 또는 경량 아키텍처를 통해 다수의 동시 요청 처리 시에도 상대적으로 낮은 CPU/메모리 사용량을 기대할 수 있는 서버
- 실제 운영 사례가 존재하며, 장기적으로 유지·관리되고 있는 성숙한 웹 서버
- ARM64 아키텍처 및 Linux(Ubuntu 계열) 환경에서 사용 이력이 있거나 공식적으로 지원되는 서버
1. Nginx
2. Apache HTTP Server
3. Caddy
4. LiteSpeed
5. Lighttpd
6. H2O
```
[ 대상 후보에서 애초에 WAS(= Web Application Server)는 배제한 이유 ]

핵심 : WAS로도 정적파일 서빙이 '가능'하지만 '최적화' 되지는 않았기 때문이다.
1. WAS는 정적 파일보다 비즈니스 로직 실행 최적화에 초점을 두고 있다.
2. 정적 파일 서빙이 애플리케이션의 스레드/이벤트루프 자원을 공유하게 되면서 트래픽 증가 시 정적파일 요청이 API 처리 리소스를 잠식하게 된다.
3. 반대로 API 요청 처리가 몰리는 경우, 스레드/이벤트루프 자원을 공유의 영향으로 정적파일 서빙도 같이 느려진다.
4. API 처리, DB 연동 등 보안 민감도가 높은 애플리케이션 로직과 클라이언트 정적 자산 서빙을 동일한 프로세스에서 처리하게 되어, 공격 표면과 장애 영향 범위가 불필요하게 확대된다.
5. WAS는 애플리케이션 런타임(JVM, 스레드 풀, GC 등)을 포함하므로 웹 서버 대비 메모리·CPU 오버헤드가 크며, 단일 인스턴스 환경에서는 가용 리소스 측면에서 불리하게 작용한다.
> 이러한 이유로 WAS들은 이 문제에 대한 후보 대상에서 고려되지 않음
```

## 각 항목에 대한 평가

각 항목에 대한 평가는 위에서 언급한 4가지 전제조건을 항목별로 평가하였으며, 각 번호가 해당 조건에 연결된다.


### 1. Nginx
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 지원한다.
2. Event-Driven / Non-blocking 매커니즘으로 동작하여 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족한다.
> Event-driven / non-blocking 구조 특성상 동시 연결 수가 증가하더라도 프로세스/스레드 증설에 따른 메모리 선형 증가가 상대적으로 작다. 이에 따라 정적 파일 및 리버스 프록시 중심의 일반적인 워크로드에서는 메모리 500MB, 평시 CPU 사용률 5% 이하 조건을 충족할 가능성이 매우 높다.
또한 동일한 구조로 동작하는 웹 서버들이 수 MB~수십 MB 수준의 메모리로
대량의 정적 파일 및 프록시 요청을 처리한 운영 사례들이 다수 존재한다.
3. ARM64 기반 Ubuntu 24.04 LTS 런타임을 지원한다.
4. Caddy에 비해 설정과 운영이 까다롭지만, 팀 내의 인프라 담당자들의 역량과 경험이 집중되어 있어 러닝커브와 작업시간을 최소화 할 수 있다.

### 2. Apache HTTP Server
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 지원한다.
2. 기본적으로 프로세스/스레드 기반 MPM 구조로 동작하며, 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족하지 못하는 경우가 발생할 수 있다.
> 프로세스/스레드 기반 MPM 구조도 워크로드 특성과 설정에 따라 충분히 효율적으로 운영할 수 있으나, 동일한 정적 파일/프록시 중심 트래픽 조건에서는 Event-Driven 기반 서버 대비 상대적으로 불리한 경우가 많다. Event MPM을 통해 이벤트 기반 처리가 가능하나, 요청 처리 과정에서 스레드 할당이 필요한 구조적 특성상 동일 트래픽 조건에서 Nginx 대비 CPU 사용량이 높아지는 경향이 있다.
3. ARM64 기반 Ubuntu 24.04 LTS 런타임을 공식적으로 지원한다.
4. 설정 구조와 모듈 구성이 Nginx 대비 복잡하며, 팀의 기존 운영 경험을 고려할 때 초기 설정 및 운영 안정화에 추가적인 학습 비용과 작업 시간이 발생할 수 있다.

### 3. Caddy
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 지원한다.
2. Event-Driven / Non-blocking 매커니즘으로 동작하여 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족한다.
3. ARM64 기반 Ubuntu 24.04 LTS 런타임을 지원한다.
4. Nginx 보다도 간편한 설정과 TLS 인증서 갱신 등의 자동화 기능으로 운영에 큰 강점이 있으나, 팀 내의 인프라 담당자들이 경험이 없는 기술로 설정과 운영에 추가적인 러닝커브와 작업시간이 발생할 수 있다.

### 4. OpenLiteSpeed
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 지원한다.
2. Event-Driven / Non-blocking 매커니즘으로 동작하여 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족한다.
3. ARM64 기반 Ubuntu 24.04 LTS 환경에서 동작 가능하다.
4. 전용 설정 구조와 Admin UI 중심의 운영 방식으로 인해 설정 관리의 일관성과 자동화 측면에서 불리하며, 팀 내의 인프라 담당자들이 경험이 없는 기술로 설정과 운영에 추가적인 러닝커브와 작업시간이 발생할 수 있다.

### 5. Lighttpd
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 지원한다.
2. Event-Driven / Non-blocking 매커니즘으로 동작하여 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족한다.
3. ARM64 기반 Ubuntu 24.04 LTS 환경에서 동작 가능하다.
4. 리버스 프록시 구성, 헤더 제어, 고급 라우팅 등 범용 웹 서버로서 요구되는 설정 기능이 제한적이어서 운영에 불리함이 있고, 팀 내의 인프라 담당자들이 경험이 없는 기술로 설정과 운영에 추가적인 러닝커브와 작업시간이 발생할 수 있다.

### 6. H2O
1. 정적 파일 서빙, 리버스 프록시, TLS 종단 기능을 기본적으로 지원한다.
2. Event-Driven / Non-blocking 매커니즘으로 동작하여 일반적인 정적 파일/프록시 워크로드 기준으로는 해당 조건을 충족한다.
3. ARM64 기반 Ubuntu 24.04 LTS 환경에서 동작 가능하다.
4. 설정 및 운영 난이도가 높고, 공식 패키지/배포 경로가 nginx만큼 정형화되어 있지 않아서 장기 운영 관점에서 업데이트, 보안 패치 관리 부담이 존재한다. 또한 팀 내의 인프라 담당자들이 경험이 없는 기술로 설정과 운영에 추가적인 러닝커브와 작업시간이 발생할 수 있다.

## 정리 및 결론

따라서 위에서 설정한 4가지 의사결정 기준을 모두 충족하는 기술은 Nginx, Caddy 로 좁혀졌다. 현재는 MVP 개발단계로 빠른 개발 및 배포가 대단히 중요하기 때문에 담당자들의 경험 부재로 인해 불확실성을 가지고 있는 러닝커브, 작업시간을 최소화 하는 것이 중요하다고 판단했다. 따라서 4가지 의사결정 기준을 모두 충족하면서도 인프라 담당자들이 지식과 경험을 가진 Nginx로 결정했다.